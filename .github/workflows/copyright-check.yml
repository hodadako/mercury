name: Copyright Check

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]

jobs:
  copyright-check:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Check Java file copyright header
        run: |
          echo "üîç Checking for correct copyright header..."
          
          failed=0
          
          while IFS= read -r -d '' file; do
            line1=$(sed -n '1p' "$file")
            line2=$(sed -n '2p' "$file")
            line3=$(sed -n '3p' "$file")
            line4=$(sed -n '4p' "$file")
          
            if [ "$line1" != '/*' ] || \
               [ "$line2" != ' * Copyright (c) 2025 mercury contributors' ] || \
               [ "$line3" != ' * This program is made available under the terms of the Apache License.' ] || \
               [ "$line4" != ' */' ]; then
              echo "‚ùå Header incorrect in: $file"
              failed=1
            fi
          done < <(find core/src -name "*.java" -print0)
          
          if [ "$failed" -eq 1 ]; then
            exit 1
          fi
          
          echo "‚úÖ All Java files have the correct header."
